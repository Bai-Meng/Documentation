## php72 环境

1. 配置 PHP72 环境

   ```shell
   $ yum install epel-release
   $ cd /opt/
   $ yum install http://rpms.remirepo.net/enterprise/remi-release-7.rpm -y
   $ yum install yum-utils -y
   $ yum update -y
   $ yum install php72 -y
   $ php72 -v
   $ yum install php72-php-fpm php72-php-gd php72-php-json php72-php-mbstring php72-php-mysqlnd php72-php-xml php72-php-xmlrpc php72-php-opcache -y
   $ systemctl enable php72-php-fpm.service
   $ systemctl start php72-php-fpm.service
   $ systemctl status php72-php-fpm.service
   $ cd /etc/opt/remi/php72/php-fpm.d/
   $ cd /etc/opt/remi/php72
   $ echo '<?php phpinfo(); ?>' | php 2>&1 |grep -i error_log
   
   # Ubuntu
   $ sudo apt-get install php7.2 php7.2-fpm php7.2-mysql
   ```

2. 配置 phpredis 环境

   ```shell
   $ php72 -info | grep redis
   $ php72 -m | grep redis
   
   # yum list php
   # yum remove php.x86_64
   $ rpm -qa | grep php
   $ rpm -e php-cli-5.4.16-48.el7.x86_64
   $ rpm -e php-common-5.4.16-48.el7.x86_64
   $ rpm -e php-mysql-5.4.16-48.el7.x86_64
   $ rpm -e php-pdo-5.4.16-48.el7.x86_64
   
   $ yum install -y php72-php-devel pcre-devel
   $ cd /tmp
   $ wget https://github.com/phpredis/phpredis/archive/refs/tags/5.3.4.tar.gz
   $ tar -zxf 5.3.4.tar.gz && cd phpredis-5.3.4/
   $ /opt/remi/php72/root/usr/bin/phpize
   $ ./configure  --with-php-config=/opt/remi/php72/root/usr/bin/php-config
   $ make && make install
   
   $ cd /etc/opt/remi/php72/php.d/
   $ echo "extension=/opt/remi/php72/root/usr/lib64/php/modules/redis.so" > /etc/opt/remi/php72/php.d/redis.ini
   
   $ systemctl restart php72-php-fpm.service
   $ php72 -m | grep redis
   ```

## 设置 GitHub 代理

```shell
$ git config --global url."https://hub.fastgit.org".insteadOf https://github.com
```

## GoLang 环境

```shell
# 下载地址：https://golang.google.cn/dl/
$ GO_VERSION="1.17.3"
$ wget https://golang.google.cn/dl/go${GO_VERSION}.linux-amd64.tar.gz
$ tar -zxf go${GO_VERSION}.linux-amd64.tar.gz -C /usr/local/
$ wget https://golang.google.cn/dl/go${GO_VERSION}.linux-amd64.tar.gz
$ echo -e "export GOROOT=/usr/local/go \nexport PATH=\$GOROOT/bin:\$PATH \nexport GOPATH=/opt/go" > /etc/profile.d/go.sh
$ source /etc/profile
$ go version

# 设置golang代理
$ export GOPROXY=https://goproxy.cn
$ export GOPROXY=https://athens.azurefd.net
```

## node 环境

```shell
# 下载地址：https://nodejs.org/dist
$ NODE_VERSION="v16.9.1"
$ wget https://nodejs.org/dist/${NODE_VERSION}/node-${NODE_VERSION}-linux-x64.tar.gz
$ tar -zxf node-${NODE_VERSION}-linux-x64.tar.gz
$ mv node-${NODE_VERSION}-linux-x64 /opt/node
$ echo -e "export NODE=/opt/node\nexport PATH=\$NODE/bin:\$PATH" > /etc/profile.d/node.sh
$ source /etc/profile
$ node -v
$ chown -R root.root /opt/node
$ npm install -g cnpm --registry=https://registry.npm.taobao.org  # 设置淘宝cnpm环境
$ cnpm install apidoc -g
$ cnpm install yarn -g
# pm2使用
$ cnpm install pm2 -g
$ pm2 list
$ pm2 log
$ pm2 stop ${SERVER_NAME}
$ pm2 delete ${SERVER_NAME}
$ pm2 start cnpm --name "${SERVER_NAME}" -- run start
# node版本管理工具
$ curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.38.0/install.sh | bash
$ nvm install v14
```

## 部署 Python3.8 服务

1. 安装依赖包

   ```shell
   # CentOS 7
   $ yum install -y centos-release-scl zlib* openssl-devel
   $ yum install -y devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9-binutils
   $ yum install -y libffi-devel
   $ gcc --version
   $ echo "source /opt/rh/devtoolset-9/enable" >>/etc/profile
   $ . /etc/profile
   $ gcc --version
   # Ubuntu 18.04
   $ sudo apt build-dep python3
   ```

2. 编译安装

   ```shell
   $ wget https://www.python.org/ftp/python/3.8.8/Python-3.8.8.tgz
   $ tar -zxf Python-3.8.8.tgz
   $ cd Python-3.8.8/
   $ ./configure --enable-optimizations --prefix=/opt/python38 --with-ssl
   $ make && make install
   # 定义环境变量
   $ echo -e "export PATH=/opt/python38/bin:\$PATH" > /etc/profile.d/python3.8.sh
   $ source /etc/profile
   ```

3. 安装相关工具包

   ```shell
   $ pip3.8 install --upgrade pip Django Pillow Pillow-PIL PyMySQL asgiref certifi chardet cos-python-sdk-v5 dicttoxml django-redis idna migrate pytz redis requests setuptools six sqlparse urllib3 DingtalkChatbot PyYAML aop et-xmlfile html-table jdcal jsonpath numpy opencv-python openpyxl panda pandas pyaml python-dateutil tencentcloud-sdk-python yagmail verse
   ```

### python pip 使用国内镜像源

1. 国内源列表

   清华 `https://pypi.tuna.tsinghua.edu.cn/simple`

   阿里云 `http://mirrors.aliyun.com/pypi/simple/`

   中国科技大学 `https://pypi.mirrors.ustc.edu.cn/simple/`

   华中理工大学 `http://pypi.hustunique.com/`

   山东理工大学 `http://pypi.sdutlinux.org/ `

   豆瓣 `http://pypi.douban.com/simple/`

   note：新版ubuntu要求使用https源，要注意。

   **例如：`pip3 install -i https://pypi.doubanio.com/simple/ 包名`**

2. 临时使用

   可以在使用pip的时候加参数 `-i https://pypi.tuna.tsinghua.edu.cn/simple`

   例如：`pip install -i https://pypi.tuna.tsinghua.edu.cn/simple pyspider`，这样就会从清华这边的镜像去安装pyspider库。

3. 永久修改

   [Linux](http://lib.csdn.net/base/linux)下，修改 `~/.pip/pip.conf` (没有就创建一个文件夹及文件。文件夹要加“.”，表示是隐藏文件夹)

   内容如下：

   ```shell
   [global]
   index-url = https://pypi.tuna.tsinghua.edu.cn/simple
   [install]
   trusted-host=mirrors.aliyun.com
   ```

   windows下，直接在user目录中创建一个pip目录，再新建文件pip.ini。（例如：C:\Users\WQP\pip\pip.ini）内容同上。

### 虚拟环境使用

```shell
$ python3 -m venv v-env  # 创建虚拟环境
$ source v-env/bin/activate  # 激活环境
$ deactivate  # 停用虚拟环境
```

## Ubuntu18.04 设置开机自启动服务

Ubuntu-18.04不能像ubuntu14一样通过编辑rc.local来设置开机启动脚本，通过下列简单设置后，可以使rc.local重新发挥作用。

1. 编辑rc-local.service文件

   ```shell
   $ vim /etc/systemd/system/rc-local.service
   # 在rc-local.service文件中加入以下内容
   [Install]  
   WantedBy=multi-user.target  
   Alias=rc-local.service
   ```

   一般启动文件需要三个组成部分

   > [Unit]段: 启动顺序与依赖关系
   >
   > [Service] 段: 启动行为,如何启动，启动类型
   >
   > [Install] 段: 定义如何安装这个配置文件，即怎样做到开机启动

2. 创建文件rc.local

   **Ubuntu-18.04 默认是没有 /etc/rc.local 这个文件的，需要自己创建**

   ```shell
   $ vim /etc/rc.local
   
   # 将下列内容复制进rc.local文件
   #!/bin/sh -e
   #
   # rc.local
   # This script is executed at the end of each multiuser runlevel.
   # Make sure that the script will "exit 0" on success or any other
   # value on error.
   # In order to enable or disable this script just change the execution
   # bits.
   # By default this script does nothing.
   sudo echo "在这里行写入你需自启动服务的脚本" > /usr/local/rc.local.log
   exit 0
   ```

3. 给rc.local加上权限

   ```shell
   $ chmod +x /etc/rc.local
   ```

4. 服务管理

   ```shell
   $ systemctl enable rc-local
   $ systemctl start rc-local.service  # 启动服务
   $ systemctl status rc-local.service  # 检查状态
   ```

5. 查看日志文件

   ```shell
   $ tail -n 10 /usr/local/rc.local.log
   ```

   

## 系统时间同步

```shell
$ vim /var/spool/cron/root
# 同步系统时间-腾讯云
*/10 * * * * /usr/sbin/ntpdate time1.cloud.tencent.com >/dev/null 2>&1
# 同步系统时间-阿里云
*/10 * * * * /usr/sbin/ntpdate ntp1.aliyun.com >/dev/null 2>&1
# 阿里云内网
* * * * * /usr/sbin/ntpdate ntp.cloud.aliyuncs.com >/dev/null 2>&1

# 修改时区
$ tzselect
$ rm -f /etc/localtime
$ ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
$ date
```

## 系统sudo权限设置

```tex
sudo权限：/bin/whoami 为只读用户，/bin/*,/sbin/* 为root权限

设置常规权限
ALL,!/bin/bash,!/bin/su,!/bin/vim /etc/sudoers,!/usr/bin/vim /etc/sudoers,!/usr/sbin/visudo,!/usr/bin/sudo -i,!/bin/chmod 777 /etc/*,!/bin/chmod 777 *,!/bin/chmod 777,!/bin/chmod -R 777 *,!/bin/rm /,!/bin/rm /srv,!/bin/rm /data,!/bin/rm /opt,!/bin/rm /*,!/bin/rm /etc,!/bin/rm /etc/*,!/bin/rm /root,!/bin/rm /root/*,!/bin/rm /bin,!/bin/rm /bin/*,!/bin/rm /usr/bin,!/bin/rm /usr/bin/*,!/bin/rm /usr/sbin,!/bin/rm /usr/sbin/*,!/usr/bin/passwd,!/bin/passwd,!/bin/kill
```



```shell
$ visudo

root    ALL=(ALL:ALL) ALL

# Members of the admin group may gain root privileges
%admin ALL=(ALL) ALL

# Allow members of group sudo to execute any command
%sudo   ALL=(ALL:ALL) ALL

# See sudoers(5) for more information on "#include" directives:

#includedir /etc/sudoers.d
ubuntu  ALL=(ALL:ALL) NOPASSWD: ALL
deploy ALL=(ALL) NOPASSWD: ALL
dev ALL=(ALL) NOPASSWD: ALL
ops ALL=(ALL) NOPASSWD: ALL
wh ALL=(ALL) NOPASSWD: /bin/whoami
```

## 添加系统用户

```shell
$ groupadd deploy; useradd deploy -m -s /bin/bash -d /home/deploy -g deploy
$ useradd guest -m -s /bin/bash -d /home/guest -g deploy
```

参数说明：

```shell
-s /sbin/nologin设置不能登陆-s /bin/false(老方法) 也行
-d 设置用户主目录
-g 用户组
-m 创建用户目录
更改用户登录权限
在增加了-s /sbin/nologin参数后，那么这个帐号就不能登陆了，如果想要恢复登陆使用
usermod -s /bin/bash username
禁用用户登录权限
usermod -s /sbin/nologin username
```

## 更换docker源

```shell
$ vim /etc/docker/daemon.json
$ tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": ["https://1tpafwoy.mirror.aliyuncs.com"]
}
EOF

$ cat /etc/docker/daemon.json 
$ systemctl daemon-reload
$ systemctl restart docker

```


